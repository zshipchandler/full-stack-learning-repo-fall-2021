{"ast":null,"code":"/*! firebase-admin v10.0.0 */\n\"use strict\";\n/*!\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.FirebaseApp = exports.FirebaseAppInternals = void 0;\n\nvar credential_internal_1 = require(\"./credential-internal\");\n\nvar validator = require(\"../utils/validator\");\n\nvar deep_copy_1 = require(\"../utils/deep-copy\");\n\nvar error_1 = require(\"../utils/error\");\n\nvar TOKEN_EXPIRY_THRESHOLD_MILLIS = 5 * 60 * 1000;\n/**\n * Internals of a FirebaseApp instance.\n */\n\nvar FirebaseAppInternals =\n/** @class */\nfunction () {\n  function FirebaseAppInternals(credential_) {\n    this.credential_ = credential_;\n    this.tokenListeners_ = [];\n  }\n\n  FirebaseAppInternals.prototype.getToken = function (forceRefresh) {\n    if (forceRefresh === void 0) {\n      forceRefresh = false;\n    }\n\n    if (forceRefresh || this.shouldRefresh()) {\n      return this.refreshToken();\n    }\n\n    return Promise.resolve(this.cachedToken_);\n  };\n\n  FirebaseAppInternals.prototype.getCachedToken = function () {\n    return this.cachedToken_ || null;\n  };\n\n  FirebaseAppInternals.prototype.refreshToken = function () {\n    var _this = this;\n\n    return Promise.resolve(this.credential_.getAccessToken()).then(function (result) {\n      // Since the developer can provide the credential implementation, we want to weakly verify\n      // the return type until the type is properly exported.\n      if (!validator.isNonNullObject(result) || typeof result.expires_in !== 'number' || typeof result.access_token !== 'string') {\n        throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INVALID_CREDENTIAL, \"Invalid access token generated: \\\"\" + JSON.stringify(result) + \"\\\". Valid access \" + 'tokens must be an object with the \"expires_in\" (number) and \"access_token\" ' + '(string) properties.');\n      }\n\n      var token = {\n        accessToken: result.access_token,\n        expirationTime: Date.now() + result.expires_in * 1000\n      };\n\n      if (!_this.cachedToken_ || _this.cachedToken_.accessToken !== token.accessToken || _this.cachedToken_.expirationTime !== token.expirationTime) {\n        // Update the cache before firing listeners. Listeners may directly query the\n        // cached token state.\n        _this.cachedToken_ = token;\n\n        _this.tokenListeners_.forEach(function (listener) {\n          listener(token.accessToken);\n        });\n      }\n\n      return token;\n    }).catch(function (error) {\n      var errorMessage = typeof error === 'string' ? error : error.message;\n      errorMessage = 'Credential implementation provided to initializeApp() via the ' + '\"credential\" property failed to fetch a valid Google OAuth2 access token with the ' + (\"following error: \\\"\" + errorMessage + \"\\\".\");\n\n      if (errorMessage.indexOf('invalid_grant') !== -1) {\n        errorMessage += ' There are two likely causes: (1) your server time is not properly ' + 'synced or (2) your certificate key file has been revoked. To solve (1), re-sync the ' + 'time on your server. To solve (2), make sure the key ID for your key file is still ' + 'present at https://console.firebase.google.com/iam-admin/serviceaccounts/project. If ' + 'not, generate a new key file at ' + 'https://console.firebase.google.com/project/_/settings/serviceaccounts/adminsdk.';\n      }\n\n      throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INVALID_CREDENTIAL, errorMessage);\n    });\n  };\n\n  FirebaseAppInternals.prototype.shouldRefresh = function () {\n    return !this.cachedToken_ || this.cachedToken_.expirationTime - Date.now() <= TOKEN_EXPIRY_THRESHOLD_MILLIS;\n  };\n  /**\n   * Adds a listener that is called each time a token changes.\n   *\n   * @param listener - The listener that will be called with each new token.\n   */\n\n\n  FirebaseAppInternals.prototype.addAuthTokenListener = function (listener) {\n    this.tokenListeners_.push(listener);\n\n    if (this.cachedToken_) {\n      listener(this.cachedToken_.accessToken);\n    }\n  };\n  /**\n   * Removes a token listener.\n   *\n   * @param listener - The listener to remove.\n   */\n\n\n  FirebaseAppInternals.prototype.removeAuthTokenListener = function (listener) {\n    this.tokenListeners_ = this.tokenListeners_.filter(function (other) {\n      return other !== listener;\n    });\n  };\n\n  return FirebaseAppInternals;\n}();\n\nexports.FirebaseAppInternals = FirebaseAppInternals;\n/**\n * Global context object for a collection of services using a shared authentication state.\n *\n * @internal\n */\n\nvar FirebaseApp =\n/** @class */\nfunction () {\n  function FirebaseApp(options, name, appStore) {\n    this.appStore = appStore;\n    this.services_ = {};\n    this.isDeleted_ = false;\n    this.name_ = name;\n    this.options_ = deep_copy_1.deepCopy(options);\n\n    if (!validator.isNonNullObject(this.options_)) {\n      throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INVALID_APP_OPTIONS, 'Invalid Firebase app options passed as the first argument to initializeApp() for the ' + (\"app named \\\"\" + this.name_ + \"\\\". Options must be a non-null object.\"));\n    }\n\n    var hasCredential = ('credential' in this.options_);\n\n    if (!hasCredential) {\n      this.options_.credential = credential_internal_1.getApplicationDefault(this.options_.httpAgent);\n    }\n\n    var credential = this.options_.credential;\n\n    if (typeof credential !== 'object' || credential === null || typeof credential.getAccessToken !== 'function') {\n      throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INVALID_APP_OPTIONS, 'Invalid Firebase app options passed as the first argument to initializeApp() for the ' + (\"app named \\\"\" + this.name_ + \"\\\". The \\\"credential\\\" property must be an object which implements \") + 'the Credential interface.');\n    }\n\n    this.INTERNAL = new FirebaseAppInternals(credential);\n  }\n\n  Object.defineProperty(FirebaseApp.prototype, \"name\", {\n    /**\n     * Returns the name of the FirebaseApp instance.\n     *\n     * @returns The name of the FirebaseApp instance.\n     */\n    get: function () {\n      this.checkDestroyed_();\n      return this.name_;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(FirebaseApp.prototype, \"options\", {\n    /**\n     * Returns the options for the FirebaseApp instance.\n     *\n     * @returns The options for the FirebaseApp instance.\n     */\n    get: function () {\n      this.checkDestroyed_();\n      return deep_copy_1.deepCopy(this.options_);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\n   * @internal\n   */\n\n  FirebaseApp.prototype.getOrInitService = function (name, init) {\n    var _this = this;\n\n    return this.ensureService_(name, function () {\n      return init(_this);\n    });\n  };\n  /**\n   * Deletes the FirebaseApp instance.\n   *\n   * @returns An empty Promise fulfilled once the FirebaseApp instance is deleted.\n   */\n\n\n  FirebaseApp.prototype.delete = function () {\n    var _this = this;\n\n    var _a;\n\n    this.checkDestroyed_(); // Also remove the instance from the AppStore. This is needed to support the existing\n    // app.delete() use case. In the future we can remove this API, and deleteApp() will\n    // become the only way to tear down an App.\n\n    (_a = this.appStore) === null || _a === void 0 ? void 0 : _a.removeApp(this.name);\n    return Promise.all(Object.keys(this.services_).map(function (serviceName) {\n      var service = _this.services_[serviceName];\n\n      if (isStateful(service)) {\n        return service.delete();\n      }\n\n      return Promise.resolve();\n    })).then(function () {\n      _this.services_ = {};\n      _this.isDeleted_ = true;\n    });\n  };\n\n  FirebaseApp.prototype.ensureService_ = function (serviceName, initializer) {\n    this.checkDestroyed_();\n\n    if (!(serviceName in this.services_)) {\n      this.services_[serviceName] = initializer();\n    }\n\n    return this.services_[serviceName];\n  };\n  /**\n   * Throws an Error if the FirebaseApp instance has already been deleted.\n   */\n\n\n  FirebaseApp.prototype.checkDestroyed_ = function () {\n    if (this.isDeleted_) {\n      throw new error_1.FirebaseAppError(error_1.AppErrorCodes.APP_DELETED, \"Firebase app named \\\"\" + this.name_ + \"\\\" has already been deleted.\");\n    }\n  };\n\n  return FirebaseApp;\n}();\n\nexports.FirebaseApp = FirebaseApp;\n\nfunction isStateful(service) {\n  return typeof service.delete === 'function';\n}","map":{"version":3,"sources":["/Users/zarashipchandler/git_dir/TPEO/Week_6/homework/frontend/node_modules/firebase-admin/lib/app/firebase-app.js"],"names":["Object","defineProperty","exports","value","FirebaseApp","FirebaseAppInternals","credential_internal_1","require","validator","deep_copy_1","error_1","TOKEN_EXPIRY_THRESHOLD_MILLIS","credential_","tokenListeners_","prototype","getToken","forceRefresh","shouldRefresh","refreshToken","Promise","resolve","cachedToken_","getCachedToken","_this","getAccessToken","then","result","isNonNullObject","expires_in","access_token","FirebaseAppError","AppErrorCodes","INVALID_CREDENTIAL","JSON","stringify","token","accessToken","expirationTime","Date","now","forEach","listener","catch","error","errorMessage","message","indexOf","addAuthTokenListener","push","removeAuthTokenListener","filter","other","options","name","appStore","services_","isDeleted_","name_","options_","deepCopy","INVALID_APP_OPTIONS","hasCredential","credential","getApplicationDefault","httpAgent","INTERNAL","get","checkDestroyed_","enumerable","configurable","getOrInitService","init","ensureService_","delete","_a","removeApp","all","keys","map","serviceName","service","isStateful","initializer","APP_DELETED"],"mappings":"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","sourcesContent":["/*! firebase-admin v10.0.0 */\n\"use strict\";\n/*!\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.FirebaseApp = exports.FirebaseAppInternals = void 0;\nvar credential_internal_1 = require(\"./credential-internal\");\nvar validator = require(\"../utils/validator\");\nvar deep_copy_1 = require(\"../utils/deep-copy\");\nvar error_1 = require(\"../utils/error\");\nvar TOKEN_EXPIRY_THRESHOLD_MILLIS = 5 * 60 * 1000;\n/**\n * Internals of a FirebaseApp instance.\n */\nvar FirebaseAppInternals = /** @class */ (function () {\n    function FirebaseAppInternals(credential_) {\n        this.credential_ = credential_;\n        this.tokenListeners_ = [];\n    }\n    FirebaseAppInternals.prototype.getToken = function (forceRefresh) {\n        if (forceRefresh === void 0) { forceRefresh = false; }\n        if (forceRefresh || this.shouldRefresh()) {\n            return this.refreshToken();\n        }\n        return Promise.resolve(this.cachedToken_);\n    };\n    FirebaseAppInternals.prototype.getCachedToken = function () {\n        return this.cachedToken_ || null;\n    };\n    FirebaseAppInternals.prototype.refreshToken = function () {\n        var _this = this;\n        return Promise.resolve(this.credential_.getAccessToken())\n            .then(function (result) {\n            // Since the developer can provide the credential implementation, we want to weakly verify\n            // the return type until the type is properly exported.\n            if (!validator.isNonNullObject(result) ||\n                typeof result.expires_in !== 'number' ||\n                typeof result.access_token !== 'string') {\n                throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INVALID_CREDENTIAL, \"Invalid access token generated: \\\"\" + JSON.stringify(result) + \"\\\". Valid access \" +\n                    'tokens must be an object with the \"expires_in\" (number) and \"access_token\" ' +\n                    '(string) properties.');\n            }\n            var token = {\n                accessToken: result.access_token,\n                expirationTime: Date.now() + (result.expires_in * 1000),\n            };\n            if (!_this.cachedToken_\n                || _this.cachedToken_.accessToken !== token.accessToken\n                || _this.cachedToken_.expirationTime !== token.expirationTime) {\n                // Update the cache before firing listeners. Listeners may directly query the\n                // cached token state.\n                _this.cachedToken_ = token;\n                _this.tokenListeners_.forEach(function (listener) {\n                    listener(token.accessToken);\n                });\n            }\n            return token;\n        })\n            .catch(function (error) {\n            var errorMessage = (typeof error === 'string') ? error : error.message;\n            errorMessage = 'Credential implementation provided to initializeApp() via the ' +\n                '\"credential\" property failed to fetch a valid Google OAuth2 access token with the ' +\n                (\"following error: \\\"\" + errorMessage + \"\\\".\");\n            if (errorMessage.indexOf('invalid_grant') !== -1) {\n                errorMessage += ' There are two likely causes: (1) your server time is not properly ' +\n                    'synced or (2) your certificate key file has been revoked. To solve (1), re-sync the ' +\n                    'time on your server. To solve (2), make sure the key ID for your key file is still ' +\n                    'present at https://console.firebase.google.com/iam-admin/serviceaccounts/project. If ' +\n                    'not, generate a new key file at ' +\n                    'https://console.firebase.google.com/project/_/settings/serviceaccounts/adminsdk.';\n            }\n            throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INVALID_CREDENTIAL, errorMessage);\n        });\n    };\n    FirebaseAppInternals.prototype.shouldRefresh = function () {\n        return !this.cachedToken_ || (this.cachedToken_.expirationTime - Date.now()) <= TOKEN_EXPIRY_THRESHOLD_MILLIS;\n    };\n    /**\n     * Adds a listener that is called each time a token changes.\n     *\n     * @param listener - The listener that will be called with each new token.\n     */\n    FirebaseAppInternals.prototype.addAuthTokenListener = function (listener) {\n        this.tokenListeners_.push(listener);\n        if (this.cachedToken_) {\n            listener(this.cachedToken_.accessToken);\n        }\n    };\n    /**\n     * Removes a token listener.\n     *\n     * @param listener - The listener to remove.\n     */\n    FirebaseAppInternals.prototype.removeAuthTokenListener = function (listener) {\n        this.tokenListeners_ = this.tokenListeners_.filter(function (other) { return other !== listener; });\n    };\n    return FirebaseAppInternals;\n}());\nexports.FirebaseAppInternals = FirebaseAppInternals;\n/**\n * Global context object for a collection of services using a shared authentication state.\n *\n * @internal\n */\nvar FirebaseApp = /** @class */ (function () {\n    function FirebaseApp(options, name, appStore) {\n        this.appStore = appStore;\n        this.services_ = {};\n        this.isDeleted_ = false;\n        this.name_ = name;\n        this.options_ = deep_copy_1.deepCopy(options);\n        if (!validator.isNonNullObject(this.options_)) {\n            throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INVALID_APP_OPTIONS, 'Invalid Firebase app options passed as the first argument to initializeApp() for the ' +\n                (\"app named \\\"\" + this.name_ + \"\\\". Options must be a non-null object.\"));\n        }\n        var hasCredential = ('credential' in this.options_);\n        if (!hasCredential) {\n            this.options_.credential = credential_internal_1.getApplicationDefault(this.options_.httpAgent);\n        }\n        var credential = this.options_.credential;\n        if (typeof credential !== 'object' || credential === null || typeof credential.getAccessToken !== 'function') {\n            throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INVALID_APP_OPTIONS, 'Invalid Firebase app options passed as the first argument to initializeApp() for the ' +\n                (\"app named \\\"\" + this.name_ + \"\\\". The \\\"credential\\\" property must be an object which implements \") +\n                'the Credential interface.');\n        }\n        this.INTERNAL = new FirebaseAppInternals(credential);\n    }\n    Object.defineProperty(FirebaseApp.prototype, \"name\", {\n        /**\n         * Returns the name of the FirebaseApp instance.\n         *\n         * @returns The name of the FirebaseApp instance.\n         */\n        get: function () {\n            this.checkDestroyed_();\n            return this.name_;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(FirebaseApp.prototype, \"options\", {\n        /**\n         * Returns the options for the FirebaseApp instance.\n         *\n         * @returns The options for the FirebaseApp instance.\n         */\n        get: function () {\n            this.checkDestroyed_();\n            return deep_copy_1.deepCopy(this.options_);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * @internal\n     */\n    FirebaseApp.prototype.getOrInitService = function (name, init) {\n        var _this = this;\n        return this.ensureService_(name, function () { return init(_this); });\n    };\n    /**\n     * Deletes the FirebaseApp instance.\n     *\n     * @returns An empty Promise fulfilled once the FirebaseApp instance is deleted.\n     */\n    FirebaseApp.prototype.delete = function () {\n        var _this = this;\n        var _a;\n        this.checkDestroyed_();\n        // Also remove the instance from the AppStore. This is needed to support the existing\n        // app.delete() use case. In the future we can remove this API, and deleteApp() will\n        // become the only way to tear down an App.\n        (_a = this.appStore) === null || _a === void 0 ? void 0 : _a.removeApp(this.name);\n        return Promise.all(Object.keys(this.services_).map(function (serviceName) {\n            var service = _this.services_[serviceName];\n            if (isStateful(service)) {\n                return service.delete();\n            }\n            return Promise.resolve();\n        })).then(function () {\n            _this.services_ = {};\n            _this.isDeleted_ = true;\n        });\n    };\n    FirebaseApp.prototype.ensureService_ = function (serviceName, initializer) {\n        this.checkDestroyed_();\n        if (!(serviceName in this.services_)) {\n            this.services_[serviceName] = initializer();\n        }\n        return this.services_[serviceName];\n    };\n    /**\n     * Throws an Error if the FirebaseApp instance has already been deleted.\n     */\n    FirebaseApp.prototype.checkDestroyed_ = function () {\n        if (this.isDeleted_) {\n            throw new error_1.FirebaseAppError(error_1.AppErrorCodes.APP_DELETED, \"Firebase app named \\\"\" + this.name_ + \"\\\" has already been deleted.\");\n        }\n    };\n    return FirebaseApp;\n}());\nexports.FirebaseApp = FirebaseApp;\nfunction isStateful(service) {\n    return typeof service.delete === 'function';\n}\n"]},"metadata":{},"sourceType":"script"}